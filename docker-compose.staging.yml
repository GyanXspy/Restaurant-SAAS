version: '3.8'

services:
  # Staging overrides for microservices
  user-service:
    environment:
      SPRING_PROFILES_ACTIVE: staging
      JAVA_OPTS: "-Xms256m -Xmx512m -XX:+UseG1GC"
    deploy:
      resources:
        limits:
          memory: 768M
          cpus: '0.5'
        reservations:
          memory: 256M
          cpus: '0.25'

  restaurant-service:
    environment:
      SPRING_PROFILES_ACTIVE: staging
      JAVA_OPTS: "-Xms256m -Xmx512m -XX:+UseG1GC"
    deploy:
      resources:
        limits:
          memory: 768M
          cpus: '0.5'
        reservations:
          memory: 256M
          cpus: '0.25'

  cart-service:
    environment:
      SPRING_PROFILES_ACTIVE: staging
      JAVA_OPTS: "-Xms256m -Xmx512m -XX:+UseG1GC"
    deploy:
      resources:
        limits:
          memory: 768M
          cpus: '0.5'
        reservations:
          memory: 256M
          cpus: '0.25'

  order-service:
    environment:
      SPRING_PROFILES_ACTIVE: staging
      JAVA_OPTS: "-Xms512m -Xmx1024m -XX:+UseG1GC"
    deploy:
      resources:
        limits:
          memory: 1.5G
          cpus: '1.0'
        reservations:
          memory: 512M
          cpus: '0.5'

  payment-service:
    environment:
      SPRING_PROFILES_ACTIVE: staging
      JAVA_OPTS: "-Xms256m -Xmx512m -XX:+UseG1GC"
    deploy:
      resources:
        limits:
          memory: 768M
          cpus: '0.5'
        reservations:
          memory: 256M
          cpus: '0.25'

  # Database configurations for staging
  mysql:
    environment:
      MYSQL_ROOT_PASSWORD: staging_root_password
      MYSQL_DATABASE: restaurant_orders_staging
      MYSQL_USER: staging_user
      MYSQL_PASSWORD: staging_password
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'
        reservations:
          memory: 512M
          cpus: '0.5'

  mysql-payment:
    environment:
      MYSQL_ROOT_PASSWORD: staging_payment_root_password
      MYSQL_DATABASE: restaurant_payments_staging
      MYSQL_USER: staging_payment_user
      MYSQL_PASSWORD: staging_payment_password
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'
        reservations:
          memory: 512M
          cpus: '0.5'

  mongodb:
    environment:
      MONGO_INITDB_ROOT_USERNAME: staging_admin
      MONGO_INITDB_ROOT_PASSWORD: staging_admin_password
      MONGO_INITDB_DATABASE: restaurant_app_staging
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'
        reservations:
          memory: 512M
          cpus: '0.5'