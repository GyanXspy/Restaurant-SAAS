# Monitoring and Observability Configuration

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,loggers,env,configprops,beans,mappings,threaddump,heapdump
      base-path: /actuator
  endpoint:
    health:
      show-details: always
      show-components: always
      probes:
        enabled: true
    metrics:
      enabled: true
    prometheus:
      enabled: true
    info:
      enabled: true
  
  # Health check configuration
  health:
    kafka:
      enabled: true
    db:
      enabled: true
    mongo:
      enabled: true
    diskspace:
      enabled: true
      threshold: 10GB
    
  # Metrics configuration
  metrics:
    enable:
      jvm: true
      system: true
      web: true
      kafka: true
    export:
      prometheus:
        enabled: true
        step: 30s
        descriptions: true
    distribution:
      percentiles-histogram:
        http.server.requests: true
        events.processing.duration: true
        sagas.execution.duration: true
      percentiles:
        http.server.requests: 0.5,0.95,0.99
        events.processing.duration: 0.5,0.95,0.99
        sagas.execution.duration: 0.5,0.95,0.99
      slo:
        http.server.requests: 100ms,500ms,1s,5s
        events.processing.duration: 100ms,1s,5s,30s
        sagas.execution.duration: 1s,10s,30s,60s
  
  # Tracing configuration
  tracing:
    enabled: true
    sampling:
      probability: 1.0
    zipkin:
      endpoint: ${ZIPKIN_ENDPOINT:http://localhost:9411/api/v2/spans}

# Info endpoint configuration
info:
  app:
    name: Restaurant Food Ordering System
    description: Event-driven microservices architecture for restaurant food ordering
    version: 1.0.0
    encoding: UTF-8
    java:
      version: ${java.version}
  build:
    artifact: ${project.artifactId:unknown}
    name: ${project.name:unknown}
    time: ${project.build.time:unknown}
    version: ${project.version:unknown}

# Logging configuration
logging:
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%X{traceId:-},%X{spanId:-}] %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%X{traceId:-},%X{spanId:-}] %logger{36} - %msg%n"
  level:
    com.restaurant: INFO
    org.springframework.kafka: INFO
    org.apache.kafka: WARN
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    brave: INFO
    zipkin2: INFO

# Custom application metrics
restaurant:
  monitoring:
    metrics:
      enabled: true
      custom-tags:
        service: ${spring.application.name:unknown}
        environment: ${ENVIRONMENT:development}
        region: ${REGION:local}
    health-checks:
      enabled: true
      timeout: 5s
    tracing:
      enabled: true
      service-name: ${spring.application.name:restaurant-service}
      
# Alerting thresholds (for external monitoring systems)
alerts:
  thresholds:
    saga:
      success-rate: 95.0
      max-active: 100
      max-processing-time: 30000
    events:
      error-rate: 5.0
      max-processing-time: 5000
    database:
      max-response-time: 1000
      max-connection-utilization: 80.0
    kafka:
      max-consumer-lag: 1000