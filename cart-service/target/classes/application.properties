# Application Configuration
spring.application.name=cart-service
server.port=${SERVER_PORT:8083}

# MongoDB Configuration
spring.data.mongodb.uri=${MONGODB_URI:mongodb://localhost:27017/cart_service?maxPoolSize=15&minPoolSize=3&maxIdleTimeMS=300000&maxLifeTimeMS=1800000&waitQueueTimeoutMS=30000&serverSelectionTimeoutMS=30000&connectTimeoutMS=30000&socketTimeoutMS=30000}
spring.data.mongodb.database=cart_service
spring.data.mongodb.auto-index-creation=false

# Spring Boot DevTools
spring.devtools.restart.enabled=true
spring.devtools.restart.additional-exclude=static/**,public/**

# MongoDB Connection Pool Settings
spring.data.mongodb.options.max-connection-pool-size=${MONGODB_POOL_MAX_SIZE:15}
spring.data.mongodb.options.min-connection-pool-size=${MONGODB_POOL_MIN_SIZE:3}
spring.data.mongodb.options.max-connection-idle-time=${MONGODB_POOL_MAX_IDLE_TIME:300000}
spring.data.mongodb.options.max-connection-life-time=${MONGODB_POOL_MAX_LIFE_TIME:1800000}
spring.data.mongodb.options.connection-timeout=${MONGODB_CONNECTION_TIMEOUT:30000}
spring.data.mongodb.options.socket-timeout=${MONGODB_SOCKET_TIMEOUT:30000}
spring.data.mongodb.options.server-selection-timeout=${MONGODB_SERVER_SELECTION_TIMEOUT:30000}
spring.data.mongodb.options.wait-queue-timeout=${MONGODB_WAIT_QUEUE_TIMEOUT:30000}

# Kafka Configuration
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}

# Kafka Topics
kafka.topic.dead-letter=cart-service-dlq

# Kafka Producer
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.properties.enable.idempotence=true
spring.kafka.producer.properties.max.in.flight.requests.per.connection=1

# Kafka Consumer
spring.kafka.consumer.group-id=${spring.application.name}
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.enable-auto-commit=false
spring.kafka.consumer.properties.spring.json.trusted.packages=com.restaurant.events

# Management Endpoints
management.endpoints.web.exposure.include=health,info,metrics,prometheus,circuitbreakers,bulkheads,retries
management.endpoint.health.show-details=always
management.health.circuitbreakers.enabled=true
management.health.bulkheads.enabled=true

# Resilience4j Circuit Breaker - MongoDB
resilience4j.circuitbreaker.instances.mongodb.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.mongodb.wait-duration-in-open-state=25s
resilience4j.circuitbreaker.instances.mongodb.sliding-window-size=8
resilience4j.circuitbreaker.instances.mongodb.minimum-number-of-calls=4
resilience4j.circuitbreaker.instances.mongodb.permitted-number-of-calls-in-half-open-state=2
resilience4j.circuitbreaker.instances.mongodb.slow-call-rate-threshold=60
resilience4j.circuitbreaker.instances.mongodb.slow-call-duration-threshold=4s
resilience4j.circuitbreaker.instances.mongodb.register-health-indicator=true

# Resilience4j Circuit Breaker - External Service
resilience4j.circuitbreaker.instances.external-service.failure-rate-threshold=60
resilience4j.circuitbreaker.instances.external-service.wait-duration-in-open-state=20s
resilience4j.circuitbreaker.instances.external-service.sliding-window-size=6
resilience4j.circuitbreaker.instances.external-service.minimum-number-of-calls=3
resilience4j.circuitbreaker.instances.external-service.permitted-number-of-calls-in-half-open-state=2
resilience4j.circuitbreaker.instances.external-service.slow-call-rate-threshold=70
resilience4j.circuitbreaker.instances.external-service.slow-call-duration-threshold=3s
resilience4j.circuitbreaker.instances.external-service.register-health-indicator=true

# Resilience4j Bulkhead - MongoDB
resilience4j.bulkhead.instances.mongodb.max-concurrent-calls=12
resilience4j.bulkhead.instances.mongodb.max-wait-duration=1s

# Resilience4j Bulkhead - External Service
resilience4j.bulkhead.instances.external-service.max-concurrent-calls=8
resilience4j.bulkhead.instances.external-service.max-wait-duration=2s

# Resilience4j Retry - MongoDB
resilience4j.retry.instances.mongodb.max-attempts=3
resilience4j.retry.instances.mongodb.wait-duration=600ms
resilience4j.retry.instances.mongodb.exponential-backoff-multiplier=1.6
resilience4j.retry.instances.mongodb.retry-exceptions=com.mongodb.MongoException,org.springframework.dao.DataAccessException

# Resilience4j Retry - External Service
resilience4j.retry.instances.external-service.max-attempts=2
resilience4j.retry.instances.external-service.wait-duration=1s
resilience4j.retry.instances.external-service.exponential-backoff-multiplier=2
resilience4j.retry.instances.external-service.retry-exceptions=java.net.ConnectException,java.net.SocketTimeoutException,org.springframework.web.client.ResourceAccessException

# Logging Configuration
logging.level.com.restaurant.cart=DEBUG
logging.level.org.springframework.kafka=INFO
logging.level.io.github.resilience4j=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
